<!doctype html>
<head>
	<meta charset="utf-8" />
	<title>Factorial Alternative - Turing machine in JavaScript</title>
	<link rel="stylesheet" href="funct/style.css" />
	<script src="funct/jquery.js"></script>
	<script src="funct/raphael.js"></script>
	<script src="funct/joint.js"></script>
	<script src="funct/turing.js"></script>
	<script>
		$(function () {

			var r = Raphael('canvas', 1240, 1000);
	var top = 300;

			var s1 = r.circle(40, top + 0, 20);
			s1.node.setAttribute('class', 'state s1');
			var t1 = r.text(40, top + 0, "s1").attr({ "font-size": 15});
			t1.node.setAttribute('class', 'text s1');

			var s2 = r.circle(200, top + 0, 20);
			s2.node.setAttribute('class', 'state s2');
			var t2 = r.text(200, top + 0, "s2").attr({ "font-size": 15});
			t2.node.setAttribute('class', 'text s2');

			var s3 = r.circle(350, top + 0, 20);
			s3.node.setAttribute('class', 'state s3');
			var t3 = r.text(350, top + 0, "s3").attr({ "font-size": 15});
			t3.node.setAttribute('class', 'text s3');

			var s4 = r.circle(500, top + 0, 20);
			s4.node.setAttribute('class', 'state s4');
			var t4 = r.text(500, top + 0, "s4").attr({ "font-size": 15});
			t4.node.setAttribute('class', 'text s4');

			var s5 = r.circle(350, top - 100, 20);
			s5.node.setAttribute('class', 'state s5');
			var t5 = r.text(350, top - 100, "s5").attr({ "font-size": 15});
			t5.node.setAttribute('class', 'text s5');


			var s6 = r.circle(500, top - 100, 20);
			s6.node.setAttribute('class', 'state s6');
			var t6 = r.text(500, top- 100, "s6").attr({ "font-size": 15});
			t6.node.setAttribute('class', 'text s6');

			var s7 = r.circle(650, top - 100, 20);
			s7.node.setAttribute('class', 'state s7');
			var t7 = r.text(650, top - 100, "s7").attr({ "font-size": 15});
			t7.node.setAttribute('class', 'text s7');

			var s8 = r.circle(800, top - 100, 20);
			s8.node.setAttribute('class', 'state s8');
			var t8 = r.text(800, top - 100, "s8").attr({ "font-size": 15});
			t8.node.setAttribute('class', 'text s8');

			var s9 = r.circle(800, top + 0, 20);
			s9.node.setAttribute('class', 'state s9');
			var t9 = r.text(800, top + 0, "s9").attr({ "font-size": 15});
			t9.node.setAttribute('class', 'text s9');

			var s10 = r.circle(950, top - 100, 20);
			s10.node.setAttribute('class', 'state s10');
			var t10 = r.text(950, top - 100, "s10").attr({ "font-size": 15});
			t10.node.setAttribute('class', 'text s10');

			var s25 = r.circle(1100, top - 100, 20);
			s25.node.setAttribute('class', 'state s25');
			var t25 = r.text(1100, top - 100, "s25").attr({ "font-size": 15});
			t25.node.setAttribute('class', 'text s25');

			var s27 = r.circle(950, top - 200, 20);
			s27.node.setAttribute('class', 'state s27');
			var t27 = r.text(950, top - 200, "s27").attr({ "font-size": 15});
			t27.node.setAttribute('class', 'text s27');

			var s26 = r.circle(950, top + 0, 20);
			s26.node.setAttribute('class', 'state s26');
			var t26 = r.text(950, top + 0, "s26").attr({ "font-size": 15});
			t26.node.setAttribute('class', 'text s26');

			var s24 = r.circle(1100, top + 0, 20);
			s24.node.setAttribute('class', 'state s24');
			var t24 = r.text(1100, top + 0, "s24").attr({ "font-size": 15});
			t24.node.setAttribute('class', 'text s24');

			var s11 = r.circle(950, top + 160, 20);
			s11.node.setAttribute('class', 'state s11');
			var t11 = r.text(950, top + 160, "s11").attr({ "font-size": 15});
			t11.node.setAttribute('class', 'text s11');

			var s12 = r.circle(800, top + 160, 20);
			s12.node.setAttribute('class', 'state s12');
			var t12 = r.text(800, top + 160, "s12").attr({ "font-size": 15});
			t12.node.setAttribute('class', 'text s12');

			var s13 = r.circle(650, top + 160, 20);
			s13.node.setAttribute('class', 'state s13');
			var t13 = r.text(650, top + 160, "s13").attr({ "font-size": 15});
			t13.node.setAttribute('class', 'text s13');

			var s14 = r.circle(500, top + 160, 20);
			s14.node.setAttribute('class', 'state s14');
			var t14 = r.text(500, top + 160, "s14").attr({ "font-size": 15});
			t14.node.setAttribute('class', 'text s14');

			var s15 = r.circle(500, top + 420, 20);
			s15.node.setAttribute('class', 'state s15');
			var t15 = r.text(500, top + 420, "s15").attr({ "font-size": 15});
			t15.node.setAttribute('class', 'text s15');

			var s16 = r.circle(650, top + 260, 20);
			s16.node.setAttribute('class', 'state s16');
			var t16 = r.text(650, top + 260, "s16").attr({ "font-size": 15});
			t16.node.setAttribute('class', 'text s16');

			var s17 = r.circle(800, top + 260, 20);
			s17.node.setAttribute('class', 'state s17');
			var t17 = r.text(800, top + 260, "s17").attr({ "font-size": 15});
			t17.node.setAttribute('class', 'text s17');

			var s23 = r.circle(1100, top + 260, 20);
			s23.node.setAttribute('class', 'state s23');
			var t23 = r.text(1100, top + 260, "s23").attr({ "font-size": 15});
			t23.node.setAttribute('class', 'text s23');

			var s22 = r.circle(1100, top + 420, 20);
			s22.node.setAttribute('class', 'state s22');
			var t22 = r.text(1100, top + 420, "s22").attr({ "font-size": 15});
			t22.node.setAttribute('class', 'text s22');

			var s21 = r.circle(950, top + 420, 20);
			s21.node.setAttribute('class', 'state s21');
			var t21 = r.text(950, top + 420, "s21").attr({ "font-size": 15});
			t21.node.setAttribute('class', 'text s21');

			var s20 = r.circle(800, top + 520, 20);
			s20.node.setAttribute('class', 'state s20');
			var t20 = r.text(800, top + 520, "s20").attr({ "font-size": 15});
			t20.node.setAttribute('class', 'text s20');

			var s18 = r.circle(650, top + 420, 20);
			s18.node.setAttribute('class', 'state s18');
			var t18 = r.text(650, top + 420, "s18").attr({ "font-size": 15});
			t18.node.setAttribute('class', 'text s18');

			var s19 = r.circle(650, top + 520, 20);
			s19.node.setAttribute('class', 'state s19');
			var t19 = r.text(650, top + 520, "s19").attr({ "font-size": 15});
			t19.node.setAttribute('class', 'text s19');











			s1.joint(s2, {label: '1 / X, R', attrs: {'stroke-dasharray': 'none'}});
			s2.joint(s2, {label: '1 / 1, R\n* / *, R', vertices: ['230 ' + (top + 80), '160 ' + (top + 80)], attrs: {'stroke-dasharray': 'none'}});
			s2.joint(s3, {label: '= / =, R', attrs: {'stroke-dasharray': 'none'}});
			s3.joint(s3, {label: '1 / 1, R',  vertices: ['380 ' + (top + 80), '320 ' + (top + 80)], attrs: {'stroke-dasharray': 'none'}});
			s3.joint(s4, {label: ' / 1, R', attrs: {'stroke-dasharray': 'none'}});
			s3.joint(s5, {label: 'Y / 1, R', attrs: {'stroke-dasharray': 'none'}});
			s4.joint(s6, {label: ' / Y, L', attrs: {'stroke-dasharray': 'none'}});
			s5.joint(s6, {label: '  / Y, L', attrs: {'stroke-dasharray': 'none'}});
			s6.joint(s6, {label: '1 / 1, L', vertices: ['470 ' + (top - 180), '530 ' + (top - 180)], attrs: {'stroke-dasharray': 'none'}});
			s6.joint(s7, {label: '= / =, L', attrs: {'stroke-dasharray': 'none'}});
			s7.joint(s7, {label: '* / *, L\n1 / 1, L', vertices: ['620 ' + (top - 180), '680 ' + (top - 180)], attrs: {'stroke-dasharray': 'none'}});
			s7.joint(s8, {label: 'X / X, R', attrs: {'stroke-dasharray': 'none'}});
			s8.joint(s2, {label: '1 / X, R', vertices: ['650 ' + (top - 220), '350 ' + (top - 220)], attrs: {'stroke-dasharray': 'none'}});

			s8.joint(s9, {label: '= / =, R', attrs: {'stroke-dasharray': 'none'}});
			s8.joint(s10, {label: '* / *, R', attrs: {'stroke-dasharray': 'none'}});
			s10.joint(s26, {label: '1 / X, R',attrs: {'stroke-dasharray': 'none'}});
			s26.joint(s9, {label: ' = / =, R', attrs: {'stroke-dasharray': 'none'}});
    //	s10.joint(s25, {label: ' * / *, R', attrs: {'stroke-dasharray': 'none'}});
			s25.joint(s25, {label: ' 1 / 1, L\n= / =, L\n * / *, L',vertices: ['1180 ' + (top - 130), '1180 ' + (top - 70)], attrs: {'stroke-dasharray': 'none'}});
			s25.joint(s27, {label: ' X / X, R', attrs: {'stroke-dasharray': 'none'}});
			s27.joint(s10, {label: ' * / *, R', attrs: {'stroke-dasharray': 'none'}});
			s24.joint(s25, {label: ' 1 / Y, L', attrs: {'stroke-dasharray': 'none'}});
			s23.joint(s24, {label: ' Y / , L', attrs: {'stroke-dasharray': 'none'}});
			s23.joint(s23, {label: ' 1 / 1, R\n / Y, L',vertices: ['1180 ' + (top + 230), '1180 ' + (top + 290)], attrs: {'stroke-dasharray': 'none'}});
			s22.joint(s23, {label: ' Y / 1, R', attrs: {'stroke-dasharray': 'none'}});
			s22.joint(s22, {label: ' 1 / 1, R\n* / *, R\n= / =, R',vertices: ['1180 ' + (top + 390), '1180 ' + (top + 450)], attrs: {'stroke-dasharray': 'none'}});
			s21.joint(s22, {label: ' * / *, R', attrs: {'stroke-dasharray': 'none'}});
			s20.joint(s21, {label: ' 1 / X, R', attrs: {'stroke-dasharray': 'none'}});
			s19.joint(s20, {label: ' X / X, R', attrs: {'stroke-dasharray': 'none'}});
			s19.joint(s19, {label: '1 / 1, L\n* / *, L',  vertices: ['680 ' + (top + 600), '620 ' + (top + 600)], attrs: {'stroke-dasharray': 'none'}});
			s18.joint(s19, {label: ' = / =, L', attrs: {'stroke-dasharray': 'none'}});
			s18.joint(s18, {label: 'C / 1, L',  vertices: ['730 ' + (top + 390), '730 ' + (top + 450)], attrs: {'stroke-dasharray': 'none'}});
			s12.joint(s18, {label: ' Y / Y, L', attrs: {'stroke-dasharray': 'none'}});
			s11.joint(s12, {label: ' = / =, R', attrs: {'stroke-dasharray': 'none'}});
			s11.joint(s11, {label: '1 / 1, R\n* / *, R',  vertices: ['1030 ' + (top + 130), '1030 ' + (top + 190)], attrs: {'stroke-dasharray': 'none'}});

			s12.joint(s13, {label: ' 1 / C, R', attrs: {'stroke-dasharray': 'none'}});
			s26.joint(s11, {label: ' 1 / 1, R', attrs: {'stroke-dasharray': 'none'}});
			s13.joint(s14, {label: ' Y / Y, R', attrs: {'stroke-dasharray': 'none'}});
			s12.joint(s12, {label: 'C / C, R',  vertices: ['830 ' + (top + 80), '770 ' + (top + 80)], attrs: {'stroke-dasharray': 'none'}});
			s13.joint(s13, {label: '1 / 1, R',  vertices: ['680 ' + (top + 80), '620 ' + (top + 80)], attrs: {'stroke-dasharray': 'none'}});
			s14.joint(s14, {label: '1 / 1, R',  vertices: ['530 ' + (top + 80), '470 ' + (top + 80)], attrs: {'stroke-dasharray': 'none'}});
			s14.joint(s15, {label: '  / 1, R', attrs: {'stroke-dasharray': 'none'}});
			s14.joint(s16, {label: ' Y / 1, R', attrs: {'stroke-dasharray': 'none'}});
			s15.joint(s17, {label: '  / Y, L', attrs: {'stroke-dasharray': 'none'}});
			s16.joint(s17, {label: '  / Y, L', attrs: {'stroke-dasharray': 'none'}});
			s17.joint(s12, {label: ' C / C, R', attrs: {'stroke-dasharray': 'none'}});
			s17.joint(s17, {label: '1 / 1, L\nY / Y, L',  vertices: ['880 ' + (top + 230), '880 ' + (top + 290)], attrs: {'stroke-dasharray': 'none'}});
			s21.joint(s11, {label: ' 1 / 1, R', attrs: {'stroke-dasharray': 'none'}});



	        // Steps
			var steps = {};

			//s1
			steps['s1:1'] = {state: 's2', value: 'X', move: 'right'};

			//s2
			steps['s2:1'] = {state: 's2', value: '1', move: 'right'};
			steps['s2:*'] = {state: 's2', value: '*', move: 'right'};
			steps['s2:='] = {state: 's3', value: '=', move: 'right'};

			//s3
	       steps['s3:1'] = {state: 's3', value: '1', move: 'right'};
	       steps['s3:Y'] = {state: 's5', value: '1', move: 'right'};
	       steps['s3:']  = {state: 's4', value: '1', move: 'right'};

	       //s4
	       steps['s4:']  = {state: 's6', value: 'Y', move: 'left'};

	       //s5
	       steps['s5:']  = {state: 's6', value: 'Y', move: 'left'};

	       //s6
	       steps['s6:1']  = {state: 's6', value: '1', move: 'left'};
	       steps['s6:=']  = {state: 's7', value: '=', move: 'left'};

	       //s7
	       steps['s7:1']  = {state: 's7', value: '1', move: 'left'};
	       steps['s7:*']  = {state: 's7', value: '*', move: 'left'};
	       steps['s7:X']  = {state: 's8', value: 'X', move: 'right'};

	       //s8
	       steps['s8:*']  = {state: 's10', value: '*', move: 'right'};
	       steps['s8:1']  = {state: 's2', value: 'X', move: 'right'};
	       steps['s8:=']  = {state: 's9', value: '=', move: 'right'};

	       //s10
	       steps['s10:1']  = {state: 's26', value: 'X', move: 'right'};
	       steps['s10:*']  = {state: 's25', value: '*', move: 'right'};

	       //s11
	       steps['s11:1']  = {state: 's11', value: '1', move: 'right'};
	       steps['s11:*']  = {state: 's11', value: '*', move: 'right'};
	       steps['s11:=']  = {state: 's12', value: '=', move: 'right'};

	       //s12
	       steps['s12:C']  = {state: 's12', value: 'C', move: 'right'};
	       steps['s12:1']  = {state: 's13', value: 'C', move: 'right'};
	       steps['s12:Y']  = {state: 's18', value: 'Y', move: 'left'};

	       //s13
	       steps['s13:1']  = {state: 's13', value: '1', move: 'right'};
	       steps['s13:Y']  = {state: 's14', value: 'Y', move: 'right'};

	       //s14
	       steps['s14:1']  = {state: 's14', value: '1', move: 'right'};
	       steps['s14:Y']  = {state: 's16', value: '1', move: 'right'};
	       steps['s14:']  = {state: 's15', value: '1', move: 'right'};

	       //s15
	       steps['s15:']  = {state: 's17', value: 'Y', move: 'left'};

	       //s16
	       steps['s16:']  = {state: 's17', value: 'Y', move: 'left'};

	       //s17
	       steps['s17:1']  = {state: 's17', value: '1', move: 'left'};
	       steps['s17:Y']  = {state: 's17', value: 'Y', move: 'left'};
	       steps['s17:C']  = {state: 's12', value: 'C', move: 'right'};

	       //18
	       steps['s18:C']  = {state: 's18', value: '1', move: 'left'};
	       steps['s18:=']  = {state: 's19', value: '=', move: 'left'};

	       //19
	       steps['s19:1']  = {state: 's19', value: '1', move: 'left'};
	       steps['s19:*']  = {state: 's19', value: '*', move: 'left'};
	       steps['s19:X']  = {state: 's20', value: 'X', move: 'right'};

	       //20
	       steps['s20:1']  = {state: 's21', value: 'X', move: 'right'};

	       //s21
	       steps['s21:*']  = {state: 's22', value: '*', move: 'right'};
	       steps['s21:1']  = {state: 's11', value: '1', move: 'right'};

	       //s22
	       steps['s22:1']  = {state: 's22', value: '1', move: 'right'};
	       steps['s22:*']  = {state: 's22', value: '*', move: 'right'};
	       steps['s22:=']  = {state: 's22', value: '=', move: 'right'};
	       steps['s22:Y']  = {state: 's23', value: '1', move: 'right'};

	       //s23
	       steps['s23:1']  = {state: 's23', value: '1', move: 'right'};
	       steps['s23:Y']  = {state: 's24', value: '', move: 'left'};

	       //s24
	       steps['s24:1']  = {state: 's25', value: 'Y', move: 'left'};

	       //s25
	       steps['s25:1']  = {state: 's25', value: '1', move: 'left'};
	       steps['s25:=']  = {state: 's25', value: '=', move: 'left'};
	       steps['s25:*']  = {state: 's25', value: '*', move: 'left'};
	       steps['s25:X']  = {state: 's27', value: 'X', move: 'right'};

	       //s26
	       steps['s26:=']  = {state: 's9', value: '=', move: 'right'};
	       steps['s26:1']  = {state: 's11', value: '1', move: 'right'};
	       steps['s26:*']  = {state: 's11', value: '*', move: 'right'};

	       //s27
	        steps['s27:*']  = {state: 's10', value: '*', move: 'right'};

			// Turning machine
			var turing = new Turing(steps, 's1', 's9');
			turing.tape = ['1', '1', '1', '*', '1', '1', '*', '1', '='];
			turing.calc = '3! =';
			turing.reset();

			$('#run').click(function () {
				turing.run();
			});

			$('#step').click(function () {
				turing.step();
			});

			$('#reset').click(function () {
				turing.reset();
			});

			$('#calc').click(function () {
				var calc = prompt('Please type in new calculation (e.g. 4!):');
				if (calc) {
					var match = calc.match(/([0-9]+)(!)/i);
					if (match) {
						var first = parseInt(match[1]);
						var tape = [];
						var i = 0;
						for(k=first; k>=1; k--) {
							for(j=0; j<k; j++) {
								tape[i++] = '1';
							}
							if(k!=1) {
								tape[i++]='*';
							}
						}


						tape[i++] = '=';
						turing.tape = tape;
						turing.calc = first + '!' + ' =';
						turing.reset();
					} else {
						alert('Sorry, invalid input!');
					}
				}
			});
		});
	</script>
</head>
<body>

	<ol class="turing"></ol>

	<div class="container1">
		<div class="actions">
			<h2>Actions</h2>
			<p>
				<input id="run" type="button" value="Run" />
				<input id="step" type="button" value="Next step" />
				<input id="reset" type="button" value="Reset" />
			</p>
		</div>
		<div class="count">
			<h2>Count</h2>
			<p id="count"></p>
		</div>
		<div class="state">
			<h2>State</h2>
			<p id="state"></p>
		</div>
		<div class="calc">
			<h2>Calculation</h2>
			<p id="calc"></p>
		</div>

		<div id="canvas"></div>
	</div>
</body>
</html>